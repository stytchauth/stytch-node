// !!!
// WARNING: This file is autogenerated
// Only modify code within MANUAL() sections
// or your changes may be overwritten later!
// !!!

import {} from "../shared/method_options";
import { DeviceInfo } from "./device_history";
import { fetchConfig } from "../shared";
import { request } from "../shared";
import { Session } from "./sessions";
import { User, WebAuthnRegistration } from "./users";

export interface WebAuthnCredential {
  // The unique, public ID of the WebAuthn credential.
  credential_id: string;
  // The unique ID for the Passkey or WebAuthn registration.
  webauthn_registration_id: string;
  // The type of the WebAuthn credential. Examples include `public-key`.
  type: string;
  // The public key for the WebAuthn credential in base64 format.
  public_key: string;
}

// Request type for `webauthn.authenticate`.
export interface WebAuthnAuthenticateRequest {
  /**
   * The response of the
   * [navigator.credentials.create()](https://www.w3.org/TR/webauthn-2/#sctn-createCredential).
   */
  public_key_credential: string;
  // The `session_token` associated with a User's existing Session.
  session_token?: string;
  /**
   * Set the session lifetime to be this many minutes from now. This will start a new session if one doesn't
   * already exist,
   *   returning both an opaque `session_token` and `session_jwt` for this session. Remember that the
   * `session_jwt` will have a fixed lifetime of
   *   five minutes regardless of the underlying session duration, and will need to be refreshed over time.
   *
   *   This value must be a minimum of 5 and a maximum of 527040 minutes (366 days).
   *
   *   If a `session_token` or `session_jwt` is provided then a successful authentication will continue to
   * extend the session this many minutes.
   *
   *   If the `session_duration_minutes` parameter is not specified, a Stytch session will not be created.
   */
  session_duration_minutes?: number;
  // The `session_jwt` associated with a User's existing Session.
  session_jwt?: string;
  /**
   * Add a custom claims map to the Session being authenticated. Claims are only created if a Session is
   * initialized by providing a value in `session_duration_minutes`. Claims will be included on the Session
   * object and in the JWT. To update a key in an existing Session, supply a new value. To delete a key,
   * supply a null value.
   *
   *   Custom claims made with reserved claims ("iss", "sub", "aud", "exp", "nbf", "iat", "jti") will be
   * ignored. Total custom claims size cannot exceed four kilobytes.
   */
  session_custom_claims?: Record<string, any>; // eslint-disable-line @typescript-eslint/no-explicit-any
  /**
   * If the `telemetry_id` is passed, as part of this request, Stytch will call the
   * [Fingerprint Lookup API](https://stytch.com/docs/fraud/api/fingerprint-lookup) and store the associated
   * fingerprints and IPGEO information for the User. Your workspace must be enabled for Device
   * Fingerprinting to use this feature.
   */
  telemetry_id?: string;
}

// Response type for `webauthn.authenticate`.
export interface WebAuthnAuthenticateResponse {
  /**
   * Globally unique UUID that is returned with every API call. This value is important to log for debugging
   * purposes; we may ask for this value to help identify a specific API call when helping you debug an issue.
   */
  request_id: string;
  // The unique ID of the affected User.
  user_id: string;
  // The unique ID for the Passkey or WebAuthn registration.
  webauthn_registration_id: string;
  // A secret token for a given Stytch Session.
  session_token: string;
  // The JSON Web Token (JWT) for a given Stytch Session.
  session_jwt: string;
  /**
   * The `user` object affected by this API call. See the
   * [Get user endpoint](https://stytch.com/docs/api/get-user) for complete response field details.
   */
  user: User;
  /**
   * The HTTP status code of the response. Stytch follows standard HTTP response status code patterns, e.g.
   * 2XX values equate to success, 3XX values are redirects, 4XX are client errors, and 5XX are server errors.
   */
  status_code: number;
  /**
   * If you initiate a Session, by including `session_duration_minutes` in your authenticate call, you'll
   * receive a full Session object in the response.
   *
   *   See [Session object](https://stytch.com/docs/api/session-object) for complete response fields.
   *
   */
  session?: Session;
  /**
   * If a valid `telemetry_id` was passed in the request and the
   * [Fingerprint Lookup API](https://stytch.com/docs/fraud/api/fingerprint-lookup) returned results, the
   * `user_device` response field will contain information about the user's device attributes.
   */
  user_device?: DeviceInfo;
}

// Request type for `webauthn.authenticateStart`.
export interface WebAuthnAuthenticateStartRequest {
  // The domain for Passkeys or WebAuthn. Defaults to `window.location.hostname`.
  domain: string;
  /**
   * The `user_id` of an active user the Passkey or WebAuthn registration should be tied to. You may use an
   * `external_id` here if one is set for the user.
   */
  user_id?: string;
  /**
   * If true, the `public_key_credential_creation_options` returned will be optimized for Passkeys with
   * `userVerification` set to `"preferred"`.
   *
   */
  return_passkey_credential_options?: boolean;
  use_base64_url_encoding?: boolean;
}

// Response type for `webauthn.authenticateStart`.
export interface WebAuthnAuthenticateStartResponse {
  /**
   * Globally unique UUID that is returned with every API call. This value is important to log for debugging
   * purposes; we may ask for this value to help identify a specific API call when helping you debug an issue.
   */
  request_id: string;
  // The unique ID of the affected User.
  user_id: string;
  // Options used for Passkey or WebAuthn authentication.
  public_key_credential_request_options: string;
  /**
   * The HTTP status code of the response. Stytch follows standard HTTP response status code patterns, e.g.
   * 2XX values equate to success, 3XX values are redirects, 4XX are client errors, and 5XX are server errors.
   */
  status_code: number;
}

// Request type for `webauthn.listCredentials`.
export interface WebAuthnListCredentialsRequest {
  // The `user_id` of an active user the Passkey or WebAuthn registration should be tied to.
  user_id: string;
  // The domain for Passkeys or WebAuthn. Defaults to `window.location.hostname`.
  domain: string;
}

// Response type for `webauthn.listCredentials`.
export interface WebAuthnListCredentialsResponse {
  // A list of WebAuthn credential objects.
  credentials: WebAuthnCredential[];
  /**
   * Globally unique UUID that is returned with every API call. This value is important to log for debugging
   * purposes; we may ask for this value to help identify a specific API call when helping you debug an issue.
   */
  request_id: string;
  /**
   * The HTTP status code of the response. Stytch follows standard HTTP response status code patterns, e.g.
   * 2XX values equate to success, 3XX values are redirects, 4XX are client errors, and 5XX are server errors.
   */
  status_code: number;
}

// Request type for `webauthn.register`.
export interface WebAuthnRegisterRequest {
  /**
   * The `user_id` of an active user the Passkey or WebAuthn registration should be tied to. You may use an
   * `external_id` here if one is set for the user.
   */
  user_id: string;
  /**
   * The response of the
   * [navigator.credentials.create()](https://www.w3.org/TR/webauthn-2/#sctn-createCredential).
   */
  public_key_credential: string;
  // The `session_token` associated with a User's existing Session.
  session_token?: string;
  /**
   * Set the session lifetime to be this many minutes from now. This will start a new session if one doesn't
   * already exist,
   *   returning both an opaque `session_token` and `session_jwt` for this session. Remember that the
   * `session_jwt` will have a fixed lifetime of
   *   five minutes regardless of the underlying session duration, and will need to be refreshed over time.
   *
   *   This value must be a minimum of 5 and a maximum of 527040 minutes (366 days).
   *
   *   If a `session_token` or `session_jwt` is provided then a successful authentication will continue to
   * extend the session this many minutes.
   *
   *   If the `session_duration_minutes` parameter is not specified, a Stytch session will not be created.
   */
  session_duration_minutes?: number;
  // The `session_jwt` associated with a User's existing Session.
  session_jwt?: string;
  /**
   * Add a custom claims map to the Session being authenticated. Claims are only created if a Session is
   * initialized by providing a value in `session_duration_minutes`. Claims will be included on the Session
   * object and in the JWT. To update a key in an existing Session, supply a new value. To delete a key,
   * supply a null value.
   *
   *   Custom claims made with reserved claims ("iss", "sub", "aud", "exp", "nbf", "iat", "jti") will be
   * ignored. Total custom claims size cannot exceed four kilobytes.
   */
  session_custom_claims?: Record<string, any>; // eslint-disable-line @typescript-eslint/no-explicit-any
  /**
   * If the `telemetry_id` is passed, as part of this request, Stytch will call the
   * [Fingerprint Lookup API](https://stytch.com/docs/fraud/api/fingerprint-lookup) and store the associated
   * fingerprints and IPGEO information for the User. Your workspace must be enabled for Device
   * Fingerprinting to use this feature.
   */
  telemetry_id?: string;
}

// Response type for `webauthn.register`.
export interface WebAuthnRegisterResponse {
  /**
   * Globally unique UUID that is returned with every API call. This value is important to log for debugging
   * purposes; we may ask for this value to help identify a specific API call when helping you debug an issue.
   */
  request_id: string;
  // The unique ID of the affected User.
  user_id: string;
  // The unique ID for the Passkey or WebAuthn registration.
  webauthn_registration_id: string;
  // A secret token for a given Stytch Session.
  session_token: string;
  // The JSON Web Token (JWT) for a given Stytch Session.
  session_jwt: string;
  user: User;
  /**
   * The HTTP status code of the response. Stytch follows standard HTTP response status code patterns, e.g.
   * 2XX values equate to success, 3XX values are redirects, 4XX are client errors, and 5XX are server errors.
   */
  status_code: number;
  /**
   * If you initiate a Session, by including `session_duration_minutes` in your authenticate call, you'll
   * receive a full Session object in the response.
   *
   *   See [Session object](https://stytch.com/docs/api/session-object) for complete response fields.
   *
   */
  session?: Session;
  /**
   * If a valid `telemetry_id` was passed in the request and the
   * [Fingerprint Lookup API](https://stytch.com/docs/fraud/api/fingerprint-lookup) returned results, the
   * `user_device` response field will contain information about the user's device attributes.
   */
  user_device?: DeviceInfo;
}

// Request type for `webauthn.registerStart`.
export interface WebAuthnRegisterStartRequest {
  /**
   * The `user_id` of an active user the Passkey or WebAuthn registration should be tied to. You may use an
   * `external_id` here if one is set for the user.
   */
  user_id: string;
  // The domain for Passkeys or WebAuthn. Defaults to `window.location.hostname`.
  domain: string;
  // The user agent of the client.
  user_agent?: string;
  /**
   * The requested authenticator type of the Passkey or WebAuthn device. The two valid values are platform
   * and cross-platform. If no value passed, we assume both values are allowed.
   */
  authenticator_type?: string;
  /**
   * If true, the `public_key_credential_creation_options` returned will be optimized for Passkeys with
   * `residentKey` set to `"required"` and `userVerification` set to `"preferred"`.
   *
   */
  return_passkey_credential_options?: boolean;
  override_id?: string;
  override_name?: string;
  override_display_name?: string;
  use_base64_url_encoding?: boolean;
}

// Response type for `webauthn.registerStart`.
export interface WebAuthnRegisterStartResponse {
  /**
   * Globally unique UUID that is returned with every API call. This value is important to log for debugging
   * purposes; we may ask for this value to help identify a specific API call when helping you debug an issue.
   */
  request_id: string;
  // The unique ID of the affected User.
  user_id: string;
  // Options used for Passkey or WebAuthn registration.
  public_key_credential_creation_options: string;
  /**
   * The HTTP status code of the response. Stytch follows standard HTTP response status code patterns, e.g.
   * 2XX values equate to success, 3XX values are redirects, 4XX are client errors, and 5XX are server errors.
   */
  status_code: number;
}

// Request type for `webauthn.update`.
export interface WebAuthnUpdateRequest {
  /**
   * Globally unique UUID that identifies a Passkey or WebAuthn registration in the Stytch API. The
   * `webauthn_registration_id` is used when you need to operate on a specific User's WebAuthn registration.
   */
  webauthn_registration_id: string;
  // The `name` of the WebAuthn registration or Passkey.
  name: string;
}

// Response type for `webauthn.update`.
export interface WebAuthnUpdateResponse {
  /**
   * Globally unique UUID that is returned with every API call. This value is important to log for debugging
   * purposes; we may ask for this value to help identify a specific API call when helping you debug an issue.
   */
  request_id: string;
  /**
   * The HTTP status code of the response. Stytch follows standard HTTP response status code patterns, e.g.
   * 2XX values equate to success, 3XX values are redirects, 4XX are client errors, and 5XX are server errors.
   */
  status_code: number;
  // A Passkey or WebAuthn registration.
  webauthn_registration?: WebAuthnRegistration;
}

export class WebAuthn {
  private fetchConfig: fetchConfig;

  constructor(fetchConfig: fetchConfig) {
    this.fetchConfig = fetchConfig;
  }

  /**
   * Initiate the process of creating a new Passkey or WebAuthn registration.
   *
   * To optimize for Passkeys, set the `return_passkey_credential_options` field to `true`.
   *
   * After calling this endpoint, the browser will need to call
   * [navigator.credentials.create()](https://www.w3.org/TR/webauthn-2/#sctn-createCredential) with the data
   * from
   * [public_key_credential_creation_options](https://w3c.github.io/webauthn/#dictionary-makecredentialoptions)
   * passed to the [navigator.credentials.create()](https://www.w3.org/TR/webauthn-2/#sctn-createCredential)
   * request via the public key argument. We recommend using the `create()` wrapper provided by the
   * webauthn-json library.
   *
   * If you are not using the [webauthn-json](https://github.com/github/webauthn-json) library, the
   * `public_key_credential_creation_options` will need to be converted to a suitable public key by
   * unmarshalling the JSON, base64 decoding the user ID field, and converting user ID and the challenge
   * fields into an array buffer.
   * @param data {@link WebAuthnRegisterStartRequest}
   * @returns {@link WebAuthnRegisterStartResponse}
   * @async
   * @throws A {@link StytchError} on a non-2xx response from the Stytch API
   * @throws A {@link RequestError} when the Stytch API cannot be reached
   */
  registerStart(
    data: WebAuthnRegisterStartRequest
  ): Promise<WebAuthnRegisterStartResponse> {
    const headers: Record<string, string> = {};
    return request<WebAuthnRegisterStartResponse>(this.fetchConfig, {
      method: "POST",
      url: `/v1/webauthn/register/start`,
      headers,
      data,
    });
  }

  /**
   * Complete the creation of a WebAuthn registration by passing the response from the
   * [navigator.credentials.create()](https://www.w3.org/TR/webauthn-2/#sctn-createCredential) request to
   * this endpoint as the `public_key_credential` parameter.
   *
   * If the [webauthn-json](https://github.com/github/webauthn-json) library's `create()` method was used,
   * the response can be passed directly to the
   * [register endpoint](https://stytch.com/docs/api/webauthn-register). If not, some fields (the client data
   * and the attestation object) from the
   * [navigator.credentials.create()](https://www.w3.org/TR/webauthn-2/#sctn-createCredential) response will
   * need to be converted from array buffers to strings and marshalled into JSON.
   * @param data {@link WebAuthnRegisterRequest}
   * @returns {@link WebAuthnRegisterResponse}
   * @async
   * @throws A {@link StytchError} on a non-2xx response from the Stytch API
   * @throws A {@link RequestError} when the Stytch API cannot be reached
   */
  register(data: WebAuthnRegisterRequest): Promise<WebAuthnRegisterResponse> {
    const headers: Record<string, string> = {};
    return request<WebAuthnRegisterResponse>(this.fetchConfig, {
      method: "POST",
      url: `/v1/webauthn/register`,
      headers,
      data,
    });
  }

  /**
   * Initiate the authentication of a Passkey or WebAuthn registration.
   *
   * To optimize for Passkeys, set the `return_passkey_credential_options` field to `true`.
   *
   * After calling this endpoint, the browser will need to call
   * [navigator.credentials.get()](https://www.w3.org/TR/webauthn-2/#sctn-getAssertion) with the data from
   * `public_key_credential_request_options` passed to the
   * [navigator.credentials.get()](https://www.w3.org/TR/webauthn-2/#sctn-getAssertion) request via the
   * public key argument. We recommend using the `get()` wrapper provided by the webauthn-json library.
   *
   * If you are not using the [webauthn-json](https://github.com/github/webauthn-json) library, `the
   * public_key_credential_request_options` will need to be converted to a suitable public key by
   * unmarshalling the JSON and converting some the fields to array buffers.
   * @param data {@link WebAuthnAuthenticateStartRequest}
   * @returns {@link WebAuthnAuthenticateStartResponse}
   * @async
   * @throws A {@link StytchError} on a non-2xx response from the Stytch API
   * @throws A {@link RequestError} when the Stytch API cannot be reached
   */
  authenticateStart(
    data: WebAuthnAuthenticateStartRequest
  ): Promise<WebAuthnAuthenticateStartResponse> {
    const headers: Record<string, string> = {};
    return request<WebAuthnAuthenticateStartResponse>(this.fetchConfig, {
      method: "POST",
      url: `/v1/webauthn/authenticate/start`,
      headers,
      data,
    });
  }

  /**
   * Complete the authentication of a Passkey or WebAuthn registration by passing the response from the
   * [navigator.credentials.get()](https://www.w3.org/TR/webauthn-2/#sctn-getAssertion) request to the
   * authenticate endpoint.
   *
   * If the [webauthn-json](https://github.com/github/webauthn-json) library's `get()` method was used, the
   * response can be passed directly to the
   * [authenticate endpoint](https://stytch.com/docs/api/webauthn-authenticate). If not some fields from the
   * [navigator.credentials.get()](https://www.w3.org/TR/webauthn-2/#sctn-getAssertion) response will need to
   * be converted from array buffers to strings and marshalled into JSON.
   * @param data {@link WebAuthnAuthenticateRequest}
   * @returns {@link WebAuthnAuthenticateResponse}
   * @async
   * @throws A {@link StytchError} on a non-2xx response from the Stytch API
   * @throws A {@link RequestError} when the Stytch API cannot be reached
   */
  authenticate(
    data: WebAuthnAuthenticateRequest
  ): Promise<WebAuthnAuthenticateResponse> {
    const headers: Record<string, string> = {};
    return request<WebAuthnAuthenticateResponse>(this.fetchConfig, {
      method: "POST",
      url: `/v1/webauthn/authenticate`,
      headers,
      data,
    });
  }

  /**
   * Updates a Passkey or WebAuthn registration.
   * @param data {@link WebAuthnUpdateRequest}
   * @returns {@link WebAuthnUpdateResponse}
   * @async
   * @throws A {@link StytchError} on a non-2xx response from the Stytch API
   * @throws A {@link RequestError} when the Stytch API cannot be reached
   */
  update(data: WebAuthnUpdateRequest): Promise<WebAuthnUpdateResponse> {
    const headers: Record<string, string> = {};
    return request<WebAuthnUpdateResponse>(this.fetchConfig, {
      method: "PUT",
      url: `/v1/webauthn/${encodeURIComponent(data.webauthn_registration_id)}`,
      headers,
      data: {
        name: data.name,
      },
    });
  }

  /**
   * List the public key credentials of the WebAuthn Registrations or Passkeys registered to a specific User.
   * @param params {@link WebAuthnListCredentialsRequest}
   * @returns {@link WebAuthnListCredentialsResponse}
   * @async
   * @throws A {@link StytchError} on a non-2xx response from the Stytch API
   * @throws A {@link RequestError} when the Stytch API cannot be reached
   */
  listCredentials(
    params: WebAuthnListCredentialsRequest
  ): Promise<WebAuthnListCredentialsResponse> {
    const headers: Record<string, string> = {};
    return request<WebAuthnListCredentialsResponse>(this.fetchConfig, {
      method: "GET",
      url: `/v1/webauthn/credentials/${encodeURIComponent(
        params.user_id
      )}/${encodeURIComponent(params.domain)}`,
      headers,
      params: {},
    });
  }
}
